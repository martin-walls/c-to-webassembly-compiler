\documentclass[aspectratio=169]{beamer}
\usetheme[numbering=none]{metropolis}

\usepackage{fontspec}
\defaultfontfeatures{Scale=MatchLowercase, Mapping=tex-text, Numbers=Lining}
\setsansfont{Libertinus Sans}
\setmonofont[Scale=0.78]{Luxi Mono}

\usepackage{tikzit}
\input{\string ~/UNI/mrw.tikzdefs}
\input{\string ~/UNI/mrw.tikzstyles}

\title{Part II Project: Progress Report}
\author{Martin Walls}
\date{}

\begin{document}
\begin{frame}
\titlepage
\end{frame}

% \begin{frame}
% \frametitle{Project overview}
% \centering\scalebox{0.7}{\tikzfig{11-overview-flowchart}}
% \end{frame}

\begin{frame}
\frametitle{Main compiler pipeline}
\begin{columns}
\column{0.2\textwidth}
\setbeamercovered{transparent}
\centering\scalebox{0.6}{\tikzfig{12-overview-flowchart-staggered}}
\column{0.8\textwidth}

\only<1>{\begin{itemize}
\item Rust parser generator: LALRPOP
\item Custom lexer, to handle \texttt{typedef} definitions (context-sensitivity).
\item Avoiding ambiguities e.g.\ dangling \texttt{else}
\end{itemize}}

\only<2>{\begin{itemize}
\item Defined three-address code representation
\item For each node in the AST, defined transformation to three-address code
\item Complexity:
\begin{itemize}
\item Switch statement logic: fall-through and \texttt{default} cases
\item Assignment: evaluating an expression either as loading a value or storing to that address
\end{itemize}
\end{itemize}}

\only<3>{
Implemented the Relooper algorithm

\begin{itemize}
\item Turning the linear sequence of IR instructions into a structure of `blocks'
\end{itemize}

\vspace{6pt}
\begin{center}
  \resizebox{0.8\linewidth}{!}{\tikzfig{13-relooper-blocks}}
\end{center}
}

\only<4>{
Target code generation
\begin{itemize}
\item Defined WebAssembly instructions for each IR instruction
\item Pushing/popping function call stack frames
\item Updating stack and frame pointers
\item Allocating addresses for variables
\end{itemize}}

\only<5>{
NodeJS runtime:
\begin{itemize}
\item Instantiate WebAssembly module
\item Initialise memory, and store program arguments
\item Implemented some of the C standard library, e.g.\ \texttt{printf}
\end{itemize}
}

\only<6>{
\frametitle{Implemented optimisations}
\begin{itemize}
\item Tail-call optimisation
\begin{itemize}
\item Find recursive tail-calls in each procedure
\item Instead, set the parameter variables to the new values and loop back to the entry point
\end{itemize}
\item Unreachable procedure elimination
\begin{itemize}
\item Generate call graph
\item Walk call graph, marking all reached functions
\item Remove all unmarked functions
\end{itemize}
\end{itemize}}


\end{columns}
\end{frame}

\begin{frame}
\frametitle{Optimised stack allocation}

\renewcommand{\rmfamily}{\sffamily}

\resizebox{\textwidth}{!}{\input{14-fibonacci-compare.pgf}}

\end{frame}



\end{document}
